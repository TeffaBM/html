<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programaci√≥n Lineal Editable</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .setup-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .section {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .section h3 {
            margin-top: 0;
            color: #FFD700;
            font-size: 1.5em;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }
        .input-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .input-group label {
            min-width: 120px;
            font-weight: bold;
            color: #E0E0E0;
        }
        .input-group input, .input-group select {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
            flex: 1;
            transition: all 0.3s ease;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            transform: scale(1.02);
        }
        .constraint-row {
            display: grid;
            grid-template-columns: 80px 80px 20px 80px 80px 20px 100px 80px;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .constraint-row input, .constraint-row select {
            padding: 8px;
            border: none;
            border-radius: 5px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .excel-table th, .excel-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .excel-table th {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        .variable-cell {
            background: #e3f2fd !important;
            font-weight: bold;
        }
        .formula-cell {
            background: #fff3e0 !important;
            font-style: italic;
        }
        .constraint-cell {
            background: #f3e5f5 !important;
        }
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .result {
            background: linear-gradient(45deg, rgba(76, 175, 80, 0.3), rgba(67, 160, 71, 0.3));
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(76, 175, 80, 0.5);
        }
        .graph-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            color: #333;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        canvas {
            width: 100%;
            max-width: 700px;
            height: 500px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }
        .variable-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .add-constraint-btn {
            background: linear-gradient(45deg, #FFA726, #FF9800);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .add-constraint-btn:hover {
            transform: scale(1.05);
        }
        .remove-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        .steps-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Solver de Programaci√≥n Lineal Personalizable</h1>
        
        <div class="setup-grid">
            <div class="section">
                <h3>üìä Funci√≥n Objetivo</h3>
                <div class="input-group">
                    <label>Tipo:</label>
                    <select id="objetivo-tipo">
                        <option value="max">Maximizar</option>
                        <option value="min">Minimizar</option>
                    </select>
                </div>
                <div id="objetivo-coeficientes">
                    <div class="input-group">
                        <label>Coef. X:</label>
                        <input type="number" id="coef-x" value="12" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Coef. Y:</label>
                        <input type="number" id="coef-y" value="20" step="0.1">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>üîß Variables de Decisi√≥n</h3>
                <div class="variable-inputs">
                    <div class="input-group">
                        <label>X (actual):</label>
                        <input type="number" id="var-x" value="30" min="0" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Y (actual):</label>
                        <input type="number" id="var-y" value="15" min="0" step="0.1">
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>üìè Restricciones</h3>
            <div id="restricciones-container">
                <div class="constraint-row" data-index="0">
                    <input type="number" class="coef-x" value="2" step="0.1" placeholder="Coef X">
                    <span>X +</span>
                    <input type="number" class="coef-y" value="3" step="0.1" placeholder="Coef Y">
                    <span>Y</span>
                    <select class="operador">
                        <option value="<=">&le;</option>
                        <option value=">=">&ge;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" class="limite" value="120" step="0.1" placeholder="L√≠mite">
                    <button class="remove-btn" onclick="removeConstraint(0)">√ó</button>
                </div>
                <div class="constraint-row" data-index="1">
                    <input type="number" class="coef-x" value="1" step="0.1" placeholder="Coef X">
                    <span>X +</span>
                    <input type="number" class="coef-y" value="1" step="0.1" placeholder="Coef Y">
                    <span>Y</span>
                    <select class="operador">
                        <option value="<=">&le;</option>
                        <option value=">=">&ge;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" class="limite" value="45" step="0.1" placeholder="L√≠mite">
                    <button class="remove-btn" onclick="removeConstraint(1)">√ó</button>
                </div>
            </div>
            <button class="add-constraint-btn" onclick="addConstraint()">+ Agregar Restricci√≥n</button>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" onclick="calculateCurrent()">üîÑ Calcular Actual</button>
            <button class="btn btn-success" onclick="solveOptimal()">üéØ Resolver √ìptimo</button>
            <button class="btn btn-secondary" onclick="resetProblem()">üîÑ Resetear</button>
        </div>

        <h2>üìã Tabla Excel Simulada</h2>
        <table class="excel-table" id="excel-table">
            <thead>
                <tr>
                    <th>Celda</th>
                    <th>Descripci√≥n</th>
                    <th>Valor</th>
                    <th>F√≥rmula Excel</th>
                </tr>
            </thead>
            <tbody id="excel-body">
                <!-- Se genera din√°micamente -->
            </tbody>
        </table>

        <div class="result" id="result">
            <!-- Resultados se muestran aqu√≠ -->
        </div>

        <div class="graph-container">
            <h3>üìà Gr√°fico de Restricciones</h3>
            <canvas id="graph" width="700" height="500"></canvas>
        </div>

        <div class="steps-container">
            <h2>üìö C√≥mo implementar en Excel:</h2>
            <div id="excel-steps">
                <!-- Los pasos se generan din√°micamente -->
            </div>
        </div>
    </div>

    <script>
        let constraintCounter = 2;
        
        function addConstraint() {
            const container = document.getElementById('restricciones-container');
            const newConstraint = document.createElement('div');
            newConstraint.className = 'constraint-row';
            newConstraint.setAttribute('data-index', constraintCounter);
            
            newConstraint.innerHTML = `
                <input type="number" class="coef-x" value="1" step="0.1" placeholder="Coef X">
                <span>X +</span>
                <input type="number" class="coef-y" value="1" step="0.1" placeholder="Coef Y">
                <span>Y</span>
                <select class="operador">
                    <option value="<=">&le;</option>
                    <option value=">=">&ge;</option>
                    <option value="=">=</option>
                </select>
                <input type="number" class="limite" value="10" step="0.1" placeholder="L√≠mite">
                <button class="remove-btn" onclick="removeConstraint(${constraintCounter})">√ó</button>
            `;
            
            container.appendChild(newConstraint);
            
            // Agregar event listeners a los nuevos elementos
            newConstraint.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('input', function() {
                    updateExcelTable();
                    calculateCurrent();
                });
                element.addEventListener('change', function() {
                    updateExcelTable();
                    calculateCurrent();
                });
            });
            
            constraintCounter++;
            updateExcelTable();
            calculateCurrent();
        }
        
        function removeConstraint(index) {
            const constraint = document.querySelector([data-index="${index}"]);
            if (constraint && document.querySelectorAll('.constraint-row').length > 1) {
                constraint.remove();
                updateExcelTable();
                calculateCurrent();
            }
        }
        
        function getConstraints() {
            const constraints = [];
            document.querySelectorAll('.constraint-row').forEach(row => {
                const coefX = parseFloat(row.querySelector('.coef-x').value) || 0;
                const coefY = parseFloat(row.querySelector('.coef-y').value) || 0;
                const operador = row.querySelector('.operador').value;
                const limite = parseFloat(row.querySelector('.limite').value) || 0;
                
                constraints.push({ coefX, coefY, operador, limite });
            });
            return constraints;
        }
        
        function updateExcelTable() {
            const tbody = document.getElementById('excel-body');
            const coefX = parseFloat(document.getElementById('coef-x').value) || 0;
            const coefY = parseFloat(document.getElementById('coef-y').value) || 0;
            const objetivo = document.getElementById('objetivo-tipo').value;
            const constraints = getConstraints();
            
            let html = `
                <tr>
                    <td>B2</td>
                    <td>Variable X</td>
                    <td class="variable-cell" id="excel-x">${document.getElementById('var-x').value}</td>
                    <td>Variable de decisi√≥n</td>
                </tr>
                <tr>
                    <td>C2</td>
                    <td>Variable Y</td>
                    <td class="variable-cell" id="excel-y">${document.getElementById('var-y').value}</td>
                    <td>Variable de decisi√≥n</td>
                </tr>
                <tr>
                    <td>D2</td>
                    <td>Funci√≥n Objetivo</td>
                    <td class="formula-cell" id="excel-objetivo">0</td>
                    <td>=${coefX}*B2+${coefY}*C2</td>
                </tr>
            `;
            
            constraints.forEach((constraint, index) => {
                const row = index + 5;
                html += `
                    <tr>
                        <td>B${row}</td>
                        <td>Restricci√≥n ${index + 1}</td>
                        <td class="constraint-cell" id="excel-rest${index}">0</td>
                        <td>=${constraint.coefX}*B2+${constraint.coefY}*C2</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        function calculateCurrent() {
            const x = parseFloat(document.getElementById('var-x').value) || 0;
            const y = parseFloat(document.getElementById('var-y').value) || 0;
            const coefX = parseFloat(document.getElementById('coef-x').value) || 0;
            const coefY = parseFloat(document.getElementById('coef-y').value) || 0;
            const constraints = getConstraints();
            
            // Actualizar tabla Excel
            document.getElementById('excel-x').textContent = x;
            document.getElementById('excel-y').textContent = y;
            
            const objetivo = coefX * x + coefY * y;
            document.getElementById('excel-objetivo').textContent = objetivo.toFixed(2);
            
            let feasible = true;
            let violatedConstraints = [];
            
            constraints.forEach((constraint, index) => {
                const value = constraint.coefX * x + constraint.coefY * y;
                document.getElementById(excel-rest${index}).textContent = value.toFixed(2);
                
                let satisfied = false;
                switch (constraint.operador) {
                    case '<=':
                        satisfied = value <= constraint.limite + 0.001; // tolerancia num√©rica
                        break;
                    case '>=':
                        satisfied = value >= constraint.limite - 0.001;
                        break;
                    case '=':
                        satisfied = Math.abs(value - constraint.limite) < 0.001;
                        break;
                }
                
                if (!satisfied) {
                    feasible = false;
                    violatedConstraints.push(index + 1);
                }
            });
            
            // Verificar no negatividad
            if (x < -0.001 || y < -0.001) {
                feasible = false;
                violatedConstraints.push('No negatividad');
            }
            
            // Mostrar resultado
            const tipoObjetivo = document.getElementById('objetivo-tipo').value;
            const result = document.getElementById('result');
            result.innerHTML = `
                <h3>üìä Resultado Actual:</h3>
                <p><strong>X:</strong> ${x}</p>
                <p><strong>Y:</strong> ${y}</p>
                <p><strong>Funci√≥n Objetivo:</strong> ${objetivo.toFixed(2)} (${tipoObjetivo === 'max' ? 'Maximizar' : 'Minimizar'})</p>
                <p><strong>Estado:</strong> <span style="color: ${feasible ? '#4CAF50' : '#f44336'}; font-weight: bold;">
                    ${feasible ? '‚úÖ FACTIBLE' : '‚ùå NO FACTIBLE'}
                </span></p>
                ${!feasible ? <p><strong>Restricciones violadas:</strong> ${violatedConstraints.join(', ')}</p> : ''}
            `;
            
            updateExcelSteps();
            drawGraph();
        }
        
        function solveOptimal() {
            const constraints = getConstraints();
            const coefX = parseFloat(document.getElementById('coef-x').value) || 0;
            const coefY = parseFloat(document.getElementById('coef-y').value) || 0;
            const isMaximize = document.getElementById('objetivo-tipo').value === 'max';
            
            // M√©todo simplex simplificado para 2 variables
            let bestValue = isMaximize ? -Infinity : Infinity;
            let bestX = 0;
            let bestY = 0;
            
            // Generar puntos candidatos (v√©rtices de la regi√≥n factible)
            const candidates = [[0, 0]]; // Origen siempre es candidato
            
            // Intersecciones con ejes
            constraints.forEach(constraint => {
                // Intersecci√≥n con eje X (y = 0)
                if (Math.abs(constraint.coefX) > 0.001) {
                    const x = constraint.limite / constraint.coefX;
                    if (x >= 0) candidates.push([x, 0]);
                }
                
                // Intersecci√≥n con eje Y (x = 0)
                if (Math.abs(constraint.coefY) > 0.001) {
                    const y = constraint.limite / constraint.coefY;
                    if (y >= 0) candidates.push([0, y]);
                }
            });
            
            // Intersecciones entre restricciones
            for (let i = 0; i < constraints.length; i++) {
                for (let j = i + 1; j < constraints.length; j++) {
                    const c1 = constraints[i];
                    const c2 = constraints[j];
                    
                    // Resolver sistema 2x2
                    const det = c1.coefX * c2.coefY - c1.coefY * c2.coefX;
                    if (Math.abs(det) > 0.001) {
                        const x = (c1.limite * c2.coefY - c1.coefY * c2.limite) / det;
                        const y = (c1.coefX * c2.limite - c1.limite * c2.coefX) / det;
                        if (x >= -0.001 && y >= -0.001) {
                            candidates.push([x, y]);
                        }
                    }
                }
            }
            
            // Evaluar candidatos
            candidates.forEach(([x, y]) => {
                if (x >= -0.001 && y >= -0.001) {
                    // Verificar factibilidad
                    let feasible = true;
                    constraints.forEach(constraint => {
                        const value = constraint.coefX * x + constraint.coefY * y;
                        switch (constraint.operador) {
                            case '<=':
                                if (value > constraint.limite + 0.001) feasible = false;
                                break;
                            case '>=':
                                if (value < constraint.limite - 0.001) feasible = false;
                                break;
                            case '=':
                                if (Math.abs(value - constraint.limite) > 0.001) feasible = false;
                                break;
                        }
                    });
                    
                    if (feasible) {
                        const objectiveValue = coefX * x + coefY * y;
                        if ((isMaximize && objectiveValue > bestValue) || 
                            (!isMaximize && objectiveValue < bestValue)) {
                            bestValue = objectiveValue;
                            bestX = Math.max(0, x);
                            bestY = Math.max(0, y);
                        }
                    }
                }
            });
            
            // Actualizar variables
            document.getElementById('var-x').value = bestX.toFixed(2);
            document.getElementById('var-y').value = bestY.toFixed(2);
            
            calculateCurrent();
            
            // Destacar resultado √≥ptimo
            const result = document.getElementById('result');
            result.style.background = 'linear-gradient(45deg, rgba(255, 215, 0, 0.3), rgba(255, 193, 7, 0.3))';
            result.innerHTML = `
                <h3>üéØ SOLUCI√ìN √ìPTIMA ENCONTRADA:</h3>
                <p><strong>X √≥ptimo:</strong> ${bestX.toFixed(2)}</p>
                <p><strong>Y √≥ptimo:</strong> ${bestY.toFixed(2)}</p>
                <p><strong>Valor √≥ptimo:</strong> ${bestValue.toFixed(2)}</p>
                <p><strong>Tipo:</strong> ${isMaximize ? 'M√ÅXIMO' : 'M√çNIMO'}</p>
                <p style="color: #FFD700; font-weight: bold; font-size: 1.2em;">‚≠ê SOLUCI√ìN √ìPTIMA ‚≠ê</p>
            `;
        }
        
        function resetProblem() {
            document.getElementById('objetivo-tipo').value = 'max';
            document.getElementById('coef-x').value = '12';
            document.getElementById('coef-y').value = '20';
            document.getElementById('var-x').value = '30';
            document.getElementById('var-y').value = '15';
            
            // Resetear restricciones a las originales
            const container = document.getElementById('restricciones-container');
            container.innerHTML = `
                <div class="constraint-row" data-index="0">
                    <input type="number" class="coef-x" value="2" step="0.1" placeholder="Coef X">
                    <span>X +</span>
                    <input type="number" class="coef-y" value="3" step="0.1" placeholder="Coef Y">
                    <span>Y</span>
                    <select class="operador">
                        <option value="<=">&le;</option>
                        <option value=">=">&ge;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" class="limite" value="120" step="0.1" placeholder="L√≠mite">
                    <button class="remove-btn" onclick="removeConstraint(0)">√ó</button>
                </div>
                <div class="constraint-row" data-index="1">
                    <input type="number" class="coef-x" value="1" step="0.1" placeholder="Coef X">
                    <span>X +</span>
                    <input type="number" class="coef-y" value="1" step="0.1" placeholder="Coef Y">
                    <span>Y</span>
                    <select class="operador">
                        <option value="<=">&le;</option>
                        <option value=">=">&ge;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" class="limite" value="45" step="0.1" placeholder="L√≠mite">
                    <button class="remove-btn" onclick="removeConstraint(1)">√ó</button>
                </div>
            `;
            
            constraintCounter = 2;
            updateExcelTable();
            calculateCurrent();
        }
        
        function updateExcelSteps() {
            const coefX = parseFloat(document.getElementById('coef-x').value) || 0;
            const coefY = parseFloat(document.getElementById('coef-y').value) || 0;
            const objetivo = document.getElementById('objetivo-tipo').value;
            const constraints = getConstraints();
            
            const stepsContainer = document.getElementById('excel-steps');
            let html = `
                <div class="step">
                    <strong>Paso 1:</strong> En Excel, configura las variables de decisi√≥n:
                    <br>‚Ä¢ B2: Variable X (valor inicial: cualquier n√∫mero)
                    <br>‚Ä¢ C2: Variable Y (valor inicial: cualquier n√∫mero)
                </div>
                <div class="step">
                    <strong>Paso 2:</strong> En D2, escribe la funci√≥n objetivo:
                    <br><code>=<strong>${coefX}</strong>*B2+<strong>${coefY}</strong>*C2</code>
                </div>
            `;
            
            constraints.forEach((constraint, index) => {
                const row = index + 5;
                html += `
                    <div class="step">
                        <strong>Paso ${index + 3}:</strong> En B${row}, escribe la restricci√≥n ${index + 1}:
                        <br><code>=<strong>${constraint.coefX}</strong>*B2+<strong>${constraint.coefY}</strong>*C2</code>
                        <br>(Debe ser <strong>${constraint.operador} ${constraint.limite}</strong>)
                    </div>
                `;
            });
            
            html += `
                <div class="step">
                    <strong>Paso Final:</strong> Ve a <strong>Datos ‚Üí Solver</strong> y configura:
                    <br>‚Ä¢ <strong>Objetivo:</strong> D2 (${objetivo === 'max' ? 'Maximizar' : 'Minimizar'})
                    <br>‚Ä¢ <strong>Variables:</strong> B2:C2
                    <br>‚Ä¢ <strong>Restricciones:</strong>
            `;
            
            constraints.forEach((constraint, index) => {
                const row = index + 5;
                html += <br>&nbsp;&nbsp;- B${row} ${constraint.operador} ${constraint.limite};
            });
            
            html += `
                    <br>&nbsp;&nbsp;- B2 ‚â• 0
                    <br>&nbsp;&nbsp;- C2 ‚â• 0
                </div>
            `;
            
            stepsContainer.innerHTML = html;
        }
        
        function drawGraph() {
            const canvas = document.getElementById('graph');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const width = canvas.width;
            const height = canvas.height;
            const maxX = 80;
            const maxY = 60;
            const padding = 60;
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - 20, height - padding);
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(padding, 20);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 1;
            const gridSteps = 8;
            for (let i = 0; i <= gridSteps; i++) {
                const x = padding + (i * (width - padding - 20) / gridSteps);
                const y = height - padding - (i * (height - padding - 20) / gridSteps);
                
                ctx.beginPath();
                ctx.moveTo(x, height - padding);
                ctx.lineTo(x, 20);
                ctx.stroke();
                
                if (i <= gridSteps) {
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - 20, y);
                    ctx.stroke();
                }
            }
            
            // Draw constraints
            const constraints = getConstraints();
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
            
            constraints.forEach((constraint, index) => {
                ctx.strokeStyle = colors[index % colors.length];
                ctx.lineWidth = 3;
                
                if (constraint.coefX !== 0 || constraint.coefY !== 0) {
                    ctx.beginPath();
                    
                    // Calculate line points
                    let x1, y1, x2, y2;
                    
                    if (Math.abs(constraint.coefY) > 0.001) {
                        // y-intercept (x = 0)
                        y1 = constraint.limite / constraint.coefY;
                        x1 = 0;
                        
                        // x-intercept (y = 0)
                        if (Math.abs(constraint.coefX) > 0.001) {
                            x2 = constraint.limite / constraint.coefX;
                            y2 = 0;
                        } else {
                            x2 = maxX;
                            y2 = y1;
                        }
                    } else if (Math.abs(constraint.coefX) > 0.001) {
                        // Vertical line
                        x1 = x2 = constraint.limite / constraint.coefX;
                        y1 = 0;
                        y2 = maxY;
                    }
                    
                    // Convert to canvas coordinates
                    const canvasX1 = padding + (x1 * (width - padding - 20) / maxX);
                    const canvasY1 = height - padding - (y1 * (height - padding - 20) / maxY);
                    const canvasX2 = padding + (x2 * (width - padding - 20) / maxX);
                    const canvasY2 = height - padding - (y2 * (height - padding - 20) / maxY);
                    
                    if (canvasX1 >= padding && canvasX1 <= width - 20 && 
                        canvasY1 >= 20 && canvasY1 <= height - padding) {
                        ctx.moveTo(canvasX1, canvasY1);
                    }
                    if (canvasX2 >= padding && canvasX2 <= width - 20 && 
                        canvasY2 >= 20 && canvasY2 <= height - padding) {
                        ctx.lineTo(canvasX2, canvasY2);
                    }
                    ctx.stroke();
                }
            });
            
            // Draw current point
            const x = parseFloat(document.getElementById('var-x').value) || 0;
            const y = parseFloat(document.getElementById('var-y').value) || 0;
            
            const pointX = padding + (x * (width - padding - 20) / maxX);
            const pointY = height - padding - (y * (height - padding - 20) / maxY);
            
            if (pointX >= padding && pointX <= width - 20 && pointY >= 20 && pointY <= height - padding) {
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(pointX, pointY, 8, 0, 2 * Math.PI);
                ctx.fill();
                
                // Label for current point
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText((${x}, ${y}), pointX + 10, pointY - 10);
            }
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('X', width - 40, height - 30);
            ctx.fillText('Y', 20, 30);
            
            // Draw constraint labels
            constraints.forEach((constraint, index) => {
                const color = colors[index % colors.length];
                ctx.fillStyle = color;
                ctx.font = '12px Arial';
                const label = ${constraint.coefX}x + ${constraint.coefY}y ${constraint.operador} ${constraint.limite};
                ctx.fillText(label, width - 200, 40 + index * 20);
            });
        }
        
        // Event listeners
        function addEventListeners() {
            document.getElementById('objetivo-tipo').addEventListener('change', calculateCurrent);
            document.getElementById('coef-x').addEventListener('input', calculateCurrent);
            document.getElementById('coef-y').addEventListener('input', calculateCurrent);
            document.getElementById('var-x').addEventListener('input', calculateCurrent);
            document.getElementById('var-y').addEventListener('input', calculateCurrent);
            
            // Add listeners to existing constraints
            document.querySelectorAll('.constraint-row input, .constraint-row select').forEach(element => {
                element.addEventListener('input', calculateCurrent);
                element.addEventListener('change', calculateCurrent);
            });
        }
